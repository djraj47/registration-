<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Tournament Registration with Supabase</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, #007bff, #6610f2);
      padding: 0;
      margin: 0;
      color: #333;
    }

    /* Navbar */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0, 0, 0, 0.6);
      padding: 12px 25px;
      position: sticky;
      top: 0;
      z-index: 999;
    }

    .navbar h2 {
      color: white;
      margin: 0;
      font-size: 20px;
    }

    .navbar a {
      color: white;
      text-decoration: none;
      margin-left: 15px;
      font-weight: bold;
      transition: 0.3s;
    }

    .navbar a:hover {
      color: #ffc107;
    }

    h1 {
      text-align: center;
      color: white;
      margin: 20px 0;
    }

    .form-container {
      background: white;
      padding: 25px;
      border-radius: 15px;
      max-width: 750px;
      margin: auto;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      animation: fadeIn 0.6s ease-in-out;
    }

    label {
      font-weight: 600;
      display: block;
      margin-top: 12px;
      color: #444;
    }

    input,
    select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 6px;
      transition: 0.3s ease;
      font-size: 15px;
    }

    input:focus,
    select:focus {
      border-color: #007bff;
      outline: none;
      box-shadow: 0 0 6px rgba(0, 123, 255, 0.4);
    }

    button {
      margin-top: 20px;
      padding: 12px 20px;
      border: none;
      background: linear-gradient(135deg, #007bff, #6610f2);
      color: white;
      font-size: 16px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
      width: 100%;
    }

    button:hover {
      background: linear-gradient(135deg, #0056b3, #520dc2);
      transform: scale(1.03);
    }

    /* Popup modal */
    .popup {
      position: fixed;
      top: -100px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      color: #333;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      font-weight: bold;
      opacity: 0;
      transition: all 0.5s ease;
      z-index: 1000;
    }

    .popup.show {
      top: 30px;
      opacity: 1;
    }

    .popup.success {
      border-left: 6px solid #28a745;
    }

    .popup.error {
      border-left: 6px solid #dc3545;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(15px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .logo-container {
      text-align: center;
      margin-bottom: 15px;
    }

    .logo {
      max-width: 120px;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      animation: fadeIn 0.8s ease-in-out;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <div class="navbar">
    <h2>BGMI Tournament</h2>
    <div>
      <a href="index.html">Home</a>
      <a href="data.html">View Teams</a>
    </div>
  </div>

  <!-- Tournament Logo -->
  <div class="logo-container">
    <img src="logo.png" alt="Tournament Logo" class="logo">
  </div>

  <h1>BGMI Tournament Registration</h1>

  <div class="form-container">
    <label>Group No (1–15)</label>
    <select id="group_no"></select>

    <label>Team No (1–20)</label>
    <select id="team_no"></select>

    <label>Team Name</label>
    <input type="text" id="team_name">

    <label>Player 1 (IGL)</label>
    <input type="text" id="player1">

    <label>Player 2</label>
    <input type="text" id="player2">

    <label>Player 3</label>
    <input type="text" id="player3">

    <label>Player 4</label>
    <input type="text" id="player4">

    <label>Contact No</label>
    <input type="text" id="contact_no">

    <label>Email</label>
    <input type="email" id="email">

    <button onclick="addTeam()">Register Team</button>

    <!-- Extra button -->
    <button onclick="window.location.href='view-teams.html'">View Registered Teams</button>
  </div>

  <!-- Popup -->
  <div id="popup" class="popup"></div>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js'

    const SUPABASE_URL = "https://xevseuyqeirvqfkzuxfi.supabase.co"
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhldnNldXlxZWlydnFma3p1eGZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0OTI5ODgsImV4cCI6MjA3MzA2ODk4OH0.1Gf7r7rzYMkWl5jPbUwBicVVsBd0jv76Pm7PSsKn4t0"
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

    const gSel = document.getElementById("group_no")
    const tSel = document.getElementById("team_no")
    const popup = document.getElementById("popup")

    function showPopup(message, type = "success") {
      popup.textContent = message
      popup.className = `popup ${type} show`
      setTimeout(() => popup.classList.remove("show"), 3000)
    }

    async function loadAvailableSlots() {
      const { data: teams, error } = await supabase.from("teams").select("group_no, team_no")
      if (error) {
        showPopup("❌ Failed to fetch slots: " + error.message, "error")
        return
      }

      const used = new Set(teams.map(t => `${t.group_no}-${t.team_no}`))
      gSel.innerHTML = ""
      tSel.innerHTML = ""

      for (let g = 1; g <= 15; g++) {
        let groupFull = true
        for (let t = 1; t <= 20; t++) {
          if (!used.has(`${g}-${t}`)) groupFull = false
        }
        if (!groupFull) {
          gSel.innerHTML += `<option value="${g}">${g}</option>`
        }
      }

      updateTeamDropdown()
    }

    async function updateTeamDropdown() {
      const group = gSel.value
      const { data: teams, error } = await supabase.from("teams").select("team_no").eq("group_no", group)
      if (error) return

      const usedTeams = new Set(teams.map(t => t.team_no))
      tSel.innerHTML = ""
      for (let t = 1; t <= 20; t++) {
        if (!usedTeams.has(t)) {
          tSel.innerHTML += `<option value="${t}">${t}</option>`
        }
      }
    }

    gSel.addEventListener("change", updateTeamDropdown)

    async function addTeam() {
      const data = {
        group_no: parseInt(gSel.value),
        team_no: parseInt(tSel.value),
        team_name: document.getElementById("team_name").value,
        player1: document.getElementById("player1").value,
        player2: document.getElementById("player2").value,
        player3: document.getElementById("player3").value,
        player4: document.getElementById("player4").value,
        contact_no: document.getElementById("contact_no").value,
        email: document.getElementById("email").value,
      }

      const { error } = await supabase.from("teams").insert([data])

      if (error) {
        if (error.code === "23505") {
          showPopup("❌ This slot is already taken!", "error")
        } else {
          showPopup("❌ Error: " + error.message, "error")
        }
      } else {
        showPopup("✅ Team registered successfully!", "success")
        await loadAvailableSlots()

        document.getElementById("team_name").value = ""
        document.getElementById("player1").value = ""
        document.getElementById("player2").value = ""
        document.getElementById("player3").value = ""
        document.getElementById("player4").value = ""
        document.getElementById("contact_no").value = ""
        document.getElementById("email").value = ""
      }
    }

    window.addTeam = addTeam
    loadAvailableSlots()
  </script>
</body>

</html>