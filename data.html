<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Teams by Group (Manage)</title>
    <style>
        body {
            font-family: "Segoe UI", Arial, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 30px;
            color: #333;
        }

        h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #007bff;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: auto;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            margin: 0;
            color: #6610f2;
        }

        .team-info {
            margin: 8px 0;
        }

        .team-info span {
            font-weight: bold;
            color: #007bff;
        }

        .team-actions {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }

        .team-actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .edit-btn {
            background: #ffc107;
            color: white;
        }

        .edit-btn:hover {
            background: #e0a800;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        input {
            width: 100%;
            margin: 5px 0;
            padding: 6px 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .save-btn {
            background: #28a745;
            color: white;
        }

        .save-btn:hover {
            background: #218838;
        }

        .back-btn {
            margin: 20px auto;
            display: block;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #007bff;
            color: white;
            cursor: pointer;
            transition: 0.3s;
        }

        .back-btn:hover {
            background: #0056b3;
        }

        .popup {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: #333;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            font-weight: bold;
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 1000;
        }

        .popup.show {
            top: 30px;
            opacity: 1;
        }

        .popup.success {
            border-left: 6px solid #28a745;
        }

        .popup.error {
            border-left: 6px solid #dc3545;
        }

        .home-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #17a2b8;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            margin-bottom: 10px;
        }

        .home-btn:hover {
            background: #117a8b;
        }

        /* Search bar styles */
        .search-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .search-container input {
            width: 280px;
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin-right: 10px;
            transition: all 0.3s;
        }

        .search-container input:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 6px rgba(0, 123, 255, 0.3);
        }

        .search-container button {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            background: #28a745;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .search-container button:hover {
            background: #218838;
        }
    </style>
</head>

<body>
    <div style="text-align:center; margin-bottom:20px;">
        <button class="home-btn" id="home-btn">üè† Home</button>
    </div>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="Search by team name or contact">
        <button id="clear-search">‚ùå Clear</button>
    </div>

    <h1>Teams by Group (Manage)</h1>

    <div class="cards-container" id="cards-container"></div>
    <button class="back-btn" id="back-btn" style="display:none;">‚¨Ö Back</button>

    <div id="popup" class="popup"></div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js'

        const SUPABASE_URL = "https://xevseuyqeirvqfkzuxfi.supabase.co"
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhldnNldXlxZWlydnFma3p1eGZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0OTI5ODgsImV4cCI6MjA3MzA2ODk4OH0.1Gf7r7rzYMkWl5jPbUwBicVVsBd0jv76Pm7PSsKn4t0"
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

        const container = document.getElementById("cards-container")
        const backBtn = document.getElementById("back-btn")
        const popup = document.getElementById("popup")
        const searchInput = document.getElementById("search-input")
        const clearSearchBtn = document.getElementById("clear-search")

        let currentGroup = null
        let searchTimeout = null

        function showPopup(message, type = "success") {
            popup.textContent = message
            popup.className = `popup ${type} show`
            setTimeout(() => popup.classList.remove("show"), 3000)
        }

        async function loadGroups() {
            currentGroup = null
            backBtn.style.display = "none"
            const { data: teams, error } = await supabase.from("teams").select("group_no")
            if (error) return showPopup("‚ùå Failed to load groups: " + error.message, "error")

            const groups = [...new Set(teams.map(t => t.group_no))].sort((a, b) => a - b)
            container.innerHTML = ""
            groups.forEach(group => {
                const card = document.createElement("div")
                card.className = "card"
                card.innerHTML = `<h2>Group ${group}</h2>`
                card.addEventListener("click", () => loadTeams(group))
                container.appendChild(card)
            })
        }

        async function loadTeams(group) {
            currentGroup = group
            backBtn.style.display = "block"
            const { data: teams, error } = await supabase.from("teams").select("*").eq("group_no", group)
            if (error) return showPopup("‚ùå Failed to load teams: " + error.message, "error")

            displayTeams(teams)
        }

        function displayTeams(teams) {
            container.innerHTML = ""
            if (!teams || teams.length === 0) {
                container.innerHTML = "<p style='text-align:center; color:#777;'>No teams found.</p>"
                return
            }

            teams.forEach(team => {
                const card = document.createElement("div")
                card.className = "card"
                card.innerHTML = `
          <h2>${team.team_name}</h2>
          <div class="team-info"><span>Team No:</span> ${team.team_no}</div>
          <div class="team-info"><span>Contact:</span> ${team.contact_no || "N/A"}</div>
          <div class="team-actions">
            <button class="edit-btn">Edit</button>
            <button class="delete-btn">Delete</button>
          </div>
        `

                card.querySelector(".edit-btn").addEventListener("click", async () => {
                    card.innerHTML = `
            <h2>Edit Team ${team.team_no}</h2>
            <input type="text" value="${team.team_name}" class="edit-team_name">
            <input type="text" value="${team.player1}" class="edit-player1">
            <input type="text" value="${team.player2}" class="edit-player2">
            <input type="text" value="${team.player3}" class="edit-player3">
            <input type="text" value="${team.player4}" class="edit-player4">
            <input type="text" value="${team.contact_no}" class="edit-contact">
            <input type="email" value="${team.email}" class="edit-email">
            <div class="team-actions">
              <button class="save-btn">Save</button>
              <button class="delete-btn">Delete</button>
            </div>
          `

                    card.querySelector(".save-btn").addEventListener("click", async () => {
                        const updatedData = {
                            team_name: card.querySelector(".edit-team_name").value,
                            player1: card.querySelector(".edit-player1").value,
                            player2: card.querySelector(".edit-player2").value,
                            player3: card.querySelector(".edit-player3").value,
                            player4: card.querySelector(".edit-player4").value,
                            contact_no: card.querySelector(".edit-contact").value,
                            email: card.querySelector(".edit-email").value
                        }

                        const { error } = await supabase.from("teams").update(updatedData).eq("group_no", team.group_no).eq("team_no", team.team_no)
                        if (error) return showPopup("‚ùå Update failed: " + error.message, "error")
                        showPopup("‚úÖ Team updated successfully!", "success")
                        currentGroup ? loadTeams(currentGroup) : searchTeams(searchInput.value)
                    })

                    card.querySelector(".delete-btn").addEventListener("click", () => deleteTeam(team.group_no, team.team_no))
                })

                card.querySelector(".delete-btn").addEventListener("click", () => deleteTeam(team.group_no, team.team_no))
                container.appendChild(card)
            })
        }

        async function deleteTeam(group_no, team_no) {
            if (!confirm("Are you sure you want to delete this team?")) return
            const { error } = await supabase.from("teams").delete().eq("group_no", group_no).eq("team_no", team_no)
            if (error) return showPopup("‚ùå Delete failed: " + error.message, "error")
            showPopup("‚úÖ Team deleted!", "success")
            currentGroup ? loadTeams(currentGroup) : searchTeams(searchInput.value)
        }

        backBtn.addEventListener("click", () => loadGroups())

        // üîç Live search feature
        async function searchTeams(query) {
            const trimmed = query.trim()
            if (!trimmed) {
                loadGroups()
                return
            }

            backBtn.style.display = "block"
            currentGroup = null

            const { data: teams, error } = await supabase
                .from("teams")
                .select("*")
                .or(`team_name.ilike.%${trimmed}%,contact_no.ilike.%${trimmed}%`)

            if (error) return showPopup("‚ùå Search failed: " + error.message, "error")

            displayTeams(teams)
        }

        searchInput.addEventListener("input", () => {
            clearTimeout(searchTimeout)
            searchTimeout = setTimeout(() => searchTeams(searchInput.value), 400)
        })

        clearSearchBtn.addEventListener("click", () => {
            searchInput.value = ""
            loadGroups()
        })

        loadGroups()

        document.getElementById("home-btn").addEventListener("click", () => {
            window.location.href = "index.html"
        });
    </script>
</body>

</html>